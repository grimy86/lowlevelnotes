
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://grimy86.github.io/Reverse_Engineering/Advanced_static/">
      
      
        <link rel="prev" href="../Basic_static/">
      
      
        <link rel="next" href="../Basic_dynamic/">
      
      
      <link rel="icon" href="/assets/Key3.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.10">
    
    
      
        <title>Advanced - Cybersecurity & Code Insights '25</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.4af4bdda.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="orange">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#advanced-static-analysis" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Cybersecurity &amp; Code Insights &#39;25" class="md-header__button md-logo" aria-label="Cybersecurity & Code Insights '25" data-md-component="logo">
      
  <img src="/assets/Key.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Cybersecurity & Code Insights '25
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Advanced
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="orange"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="orange"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/grimy86/grimy86.github.io" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    grimy86.github.io
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../.." class="md-tabs__link">
          
  
  
    
  
  Home

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../CSharp/Level1/Basics/" class="md-tabs__link">
          
  
  
    
  
  Learn Programming

        </a>
      </li>
    
  

    
  

    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../Windows_Internals/Introduction/" class="md-tabs__link">
          
  
  
    
  
  Windows Internals

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../Intro/" class="md-tabs__link">
          
  
  
    
  
  Reverse Engineering

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../Networks/Networks/" class="md-tabs__link">
          
  
  
    
  
  Networks & CyberSecurity

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../About/changelog/" class="md-tabs__link">
          
  
  
    
  
  About

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Cybersecurity &amp; Code Insights &#39;25" class="md-nav__button md-logo" aria-label="Cybersecurity & Code Insights '25" data-md-component="logo">
      
  <img src="/assets/Key.png" alt="logo">

    </a>
    Cybersecurity & Code Insights '25
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/grimy86/grimy86.github.io" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    grimy86.github.io
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../.." class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    
  
  
  
    
  
  
  
    <a href="../../CSharp/Level1/Basics/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Learn Programming
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

  

  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../Windows_Internals/Introduction/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Windows Internals
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Reverse Engineering
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Reverse Engineering
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Intro/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction to analysis
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" checked>
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Static analysis
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Static analysis
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Basic_static/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Basic
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Advanced
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Advanced
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#malware-analysis-overview" class="md-nav__link">
    <span class="md-ellipsis">
      Malware analysis overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-advanced-static-analysis-is-performed" class="md-nav__link">
    <span class="md-ellipsis">
      How advanced static analysis is performed
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ghidra" class="md-nav__link">
    <span class="md-ellipsis">
      Ghidra
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Ghidra">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-to-use-ghidra" class="md-nav__link">
    <span class="md-ellipsis">
      How to use Ghidra
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ghidra-layout" class="md-nav__link">
    <span class="md-ellipsis">
      Ghidra layout
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#identifying-c-code-constructs-in-assembly" class="md-nav__link">
    <span class="md-ellipsis">
      Identifying C code constructs in Assembly
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Identifying C code constructs in Assembly">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hello-world-example" class="md-nav__link">
    <span class="md-ellipsis">
      Hello World example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#for-loop-example" class="md-nav__link">
    <span class="md-ellipsis">
      For loop example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#function-example" class="md-nav__link">
    <span class="md-ellipsis">
      Function example
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#an-overview-of-api-calls" class="md-nav__link">
    <span class="md-ellipsis">
      An overview of API calls
    </span>
  </a>
  
    <nav class="md-nav" aria-label="An overview of API calls">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#createprocessa-example" class="md-nav__link">
    <span class="md-ellipsis">
      CreateProcessA example
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#common-apis-used-by-malware" class="md-nav__link">
    <span class="md-ellipsis">
      Common APIs used by Malware
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Common APIs used by Malware">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#keylogger" class="md-nav__link">
    <span class="md-ellipsis">
      Keylogger
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#downloader" class="md-nav__link">
    <span class="md-ellipsis">
      Downloader
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#c2-communication" class="md-nav__link">
    <span class="md-ellipsis">
      C2 Communication
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-exfiltration" class="md-nav__link">
    <span class="md-ellipsis">
      Data Exfiltration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dropper" class="md-nav__link">
    <span class="md-ellipsis">
      Dropper
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#api-hooking" class="md-nav__link">
    <span class="md-ellipsis">
      API Hooking
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anti-debugging-and-vm-detection" class="md-nav__link">
    <span class="md-ellipsis">
      Anti-debugging and VM detection
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#analyzing-process-hollowing" class="md-nav__link">
    <span class="md-ellipsis">
      Analyzing process hollowing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Analyzing process hollowing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#createprocess" class="md-nav__link">
    <span class="md-ellipsis">
      CreateProcess
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#graph-view" class="md-nav__link">
    <span class="md-ellipsis">
      Graph View
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-of-further-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Example of further analysis
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Dynamic analysis
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            Dynamic analysis
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Basic_dynamic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Basic
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Dynamic_debugging/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Debugging
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Anti_reversing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Anti-reverse engineering
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_5" >
        
          
          <label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Tool cheat sheets
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            Tool cheat sheets
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../CAPA/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CAPA
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../VMs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    REMnux & FLARE VM
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    
  
  
  
    <a href="../../Networks/Networks/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Networks & CyberSecurity
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../About/changelog/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    About
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#malware-analysis-overview" class="md-nav__link">
    <span class="md-ellipsis">
      Malware analysis overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-advanced-static-analysis-is-performed" class="md-nav__link">
    <span class="md-ellipsis">
      How advanced static analysis is performed
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ghidra" class="md-nav__link">
    <span class="md-ellipsis">
      Ghidra
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Ghidra">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-to-use-ghidra" class="md-nav__link">
    <span class="md-ellipsis">
      How to use Ghidra
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ghidra-layout" class="md-nav__link">
    <span class="md-ellipsis">
      Ghidra layout
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#identifying-c-code-constructs-in-assembly" class="md-nav__link">
    <span class="md-ellipsis">
      Identifying C code constructs in Assembly
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Identifying C code constructs in Assembly">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hello-world-example" class="md-nav__link">
    <span class="md-ellipsis">
      Hello World example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#for-loop-example" class="md-nav__link">
    <span class="md-ellipsis">
      For loop example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#function-example" class="md-nav__link">
    <span class="md-ellipsis">
      Function example
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#an-overview-of-api-calls" class="md-nav__link">
    <span class="md-ellipsis">
      An overview of API calls
    </span>
  </a>
  
    <nav class="md-nav" aria-label="An overview of API calls">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#createprocessa-example" class="md-nav__link">
    <span class="md-ellipsis">
      CreateProcessA example
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#common-apis-used-by-malware" class="md-nav__link">
    <span class="md-ellipsis">
      Common APIs used by Malware
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Common APIs used by Malware">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#keylogger" class="md-nav__link">
    <span class="md-ellipsis">
      Keylogger
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#downloader" class="md-nav__link">
    <span class="md-ellipsis">
      Downloader
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#c2-communication" class="md-nav__link">
    <span class="md-ellipsis">
      C2 Communication
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-exfiltration" class="md-nav__link">
    <span class="md-ellipsis">
      Data Exfiltration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dropper" class="md-nav__link">
    <span class="md-ellipsis">
      Dropper
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#api-hooking" class="md-nav__link">
    <span class="md-ellipsis">
      API Hooking
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anti-debugging-and-vm-detection" class="md-nav__link">
    <span class="md-ellipsis">
      Anti-debugging and VM detection
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#analyzing-process-hollowing" class="md-nav__link">
    <span class="md-ellipsis">
      Analyzing process hollowing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Analyzing process hollowing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#createprocess" class="md-nav__link">
    <span class="md-ellipsis">
      CreateProcess
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#graph-view" class="md-nav__link">
    <span class="md-ellipsis">
      Graph View
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-of-further-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Example of further analysis
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="advanced-static-analysis">Advanced Static analysis<a class="headerlink" href="#advanced-static-analysis" title="Permanent link">&para;</a></h1>
<p>In Advanced Static Analysis, we will move further and reverse engineer malware into the disassembled code and <code>analyze the assembly instructions</code> to understand the malware's core functionality in a better way.</p>
<p>Advanced static analysis is a technique used to analyze the code and structure of malware without executing it. This can help us identify the malware's behavior and weaknesses and develop signatures for antivirus software to detect it. By analyzing the code and structure of malware, researchers can also better understand how it works and develop new techniques for defending against it.</p>
<h2 id="malware-analysis-overview">Malware analysis overview<a class="headerlink" href="#malware-analysis-overview" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>Technique</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Basic static analysis</td>
<td>Aims to understand the malware's <code>structure</code>. Involves examining the malware's <code>code</code>, <code>file headers</code>, and <code>other static properties</code>.</td>
</tr>
<tr>
<td>Advanced static analysis</td>
<td>Aims to uncover <code>hidden or obfuscated code and functionality</code> within the malware. Involves using more advanced techniques to analyze the malware's code, such as <code>deobfuscation</code> and <code>code emulation</code>.</td>
</tr>
<tr>
<td>Basic dynamic analysis</td>
<td>Aims to observe the malware's <code>behavior during execution</code> in a controlled environment. Involves <code>executing</code> the malware in a sandbox or virtual machine and <code>monitoring</code> its <code>system activity</code>, <code>network traffic</code>, and <code>process behavior</code>.</td>
</tr>
<tr>
<td>Advanced dynamic analysis</td>
<td>Aims to uncover more <code>complex and evasive malware behavior</code> using advanced monitoring techniques. Involves using more sophisticated sandboxes and monitoring tools to <code>capture the malware's behavior in greater detail</code>.</td>
</tr>
</tbody>
</table>
<h2 id="how-advanced-static-analysis-is-performed">How advanced static analysis is performed<a class="headerlink" href="#how-advanced-static-analysis-is-performed" title="Permanent link">&para;</a></h2>
<p>To perform advanced static analysis, <code>disassemblers</code> such as <code>IDA Pro</code>, <code>Binary Ninja</code>, and <code>radare2</code> are commonly used. These disassemblers allow the analyst to explore the malware's code and <code>identify its functions and data structures</code>.</p>
<p>The steps involved in performing advanced static analysis of malware are as follows:</p>
<ul>
<li>Identify the <code>entry point</code> of the malware and the <code>system calls</code> it makes.</li>
<li>Identify the malware's <code>code sections</code> and analyze them using available tools such as <code>debuggers</code> and <code>hex editors</code>.</li>
<li>Analyze the malware's <code>control flow</code> graph to identify its <code>execution path</code>.</li>
<li>Trace the malware's dynamic behavior by <code>analyzing the system calls</code> it makes during execution.</li>
<li>Use the above information to understand the malware's <code>evasion techniques</code> and the <code>potential damage it can cause</code>.</li>
</ul>
<h2 id="ghidra">Ghidra<a class="headerlink" href="#ghidra" title="Permanent link">&para;</a></h2>
<p>Many <code>disassemblers</code> like Cutter, radare2, Ghidra, and IDA Pro can be used to disassemble malware. However, we will explore Ghidra because it's <code>free</code>, <code>open-source</code>, and has <code>many features</code> that can be utilized to get proficient in reverse engineering.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The objective is to get comfortable with the main usage of a disassembler and use that knowledge to use any disassembler.</p>
</div>
<p><code>Ghidra</code> is a software reverse engineering tool that allows users to analyze compiled code to understand its functionality. It is designed to help analysts and developers understand how the software works by providing a platform to <code>decompile</code>, <code>disassemble</code>, and <code>debug binaries</code>.</p>
<p>Ghidra includes many features that make it a powerful reverse engineering tool. Some of these features include:</p>
<ul>
<li><code>Decompilation</code>: Ghidra can <code>decompile</code> binaries <code>into readable C code</code>, making it easier for developers to understand how the software works.</li>
<li><code>Disassembly</code>: Ghidra can <code>disassemble</code> binaries <code>into assembly language</code>, allowing analysts to examine the low-level operations of the code.</li>
<li><code>Debugging</code>: Ghidra has a built-in <code>debugger</code> that allows users to <code>step through</code> code and examine its behavior.</li>
<li><code>Analysis</code>: Ghidra can <code>automatically identify functions</code>, <code>variables</code>, and <code>other code</code> to help users understand the <code>structure of the code</code>.</li>
</ul>
<h3 id="how-to-use-ghidra">How to use Ghidra<a class="headerlink" href="#how-to-use-ghidra" title="Permanent link">&para;</a></h3>
<ol>
<li>Open Ghidra and create a <code>new project</code>.</li>
<li>
<p>Select <code>Non-Shared Project</code>.</p>
<p>Selecting Shared Project would allow us to share our analysis with other analysts.</p>
</li>
<li>
<p>Name the project and <code>set the directory</code> or leave the default path.</p>
</li>
<li><code>Import</code> the executable you want to analyze. Now that we have created an empty project, let's Drag &amp; Drop the executable and select the program.</li>
<li>Once it's imported, it shows us the summary of the program.</li>
<li><code>Double-click on the .exe</code> to open it in the Code Browser. When asked to analyze the executable, <code>click on Yes</code>.</li>
<li>The next window that appears shows us various analysis options. We can <code>check or uncheck them based on our needs</code>. These plug-ins or add-ons assist Ghidra during the analysis.</li>
<li>It will take some time to analyze. The bar on the bottom-right shows the progress. <code>Wait</code> until the analysis is 100%.</li>
</ol>
<h3 id="ghidra-layout">Ghidra layout<a class="headerlink" href="#ghidra-layout" title="Permanent link">&para;</a></h3>
<p><img alt="Ghidra layout" src="/Reverse_Engineering/Images/Ghidra_layout.png" /></p>
<ol>
<li>
<p><code>Program Trees</code>: Shows (PE) sections of the program. We can click on different sections to see the content within each.</p>
</li>
<li>
<p><code>Symbol Tree</code>:</p>
<ul>
<li><code>Imports</code>: This section contains information about the <code>libraries being imported</code> by the program. Clicking on each API call shows the assembly code that uses that API.</li>
<li><code>Exports</code>: This section contains the API/function calls being exported by the program. This section is <code>useful when analyzing a DLL</code>, as it will show all the functions dll contains.</li>
<li><code>Functions</code>: This section contains the functions it finds within the code. Clicking on each function will take us to the disassembled code of that function. It also contains the <code>entry function</code>. Clicking on the entry function will take us to the <code>start of the program</code> we are analyzing. Functions with <code>generic names</code> starting with <code>FUN_VirtualAddress</code> are the ones that <code>Ghidra does not give any names to</code>.</li>
</ul>
</li>
<li>
<p><code>Data Type Manager</code>: This section shows various data types found in the program.</p>
</li>
<li>
<p><code>Listing</code>: This window shows the disassembled code of the binary, which includes the following values in order.</p>
<ul>
<li><code>Virtual Address</code></li>
<li><code>Opcode</code></li>
<li><code>Assembly Instruction (PUSH, POP, ADD, XOR, etc.)</code></li>
<li><code>Operands</code></li>
<li><code>Comments</code></li>
</ul>
</li>
<li>
<p><code>Decompile</code>: Ghidra translates the assembly code into a <code>pseudo C code</code> here. This is a very important section to look at during analysis as it gives a better understanding of the assembly code.</p>
</li>
<li>
<p><code>Toolbar</code>: It has various <code>options to use</code> during the analysis.</p>
</li>
<li>
<p><code>Graph View</code>: The Graph View in the toolbar is an important option, allowing us to see the graph view of the disassembly:</p>
<p><img alt="Graph view" src="/Reverse_Engineering/Images/Graph_view.png" /></p>
</li>
<li>
<p>The <code>Memory Map</code> option shows the memory mapping of the program as shown below:</p>
<p><img alt="Memory map" src="/Reverse_Engineering/Images/Memory_map.png" /></p>
</li>
<li>
<p>This <code>navigation toolbar</code> shows different options to navigate through the code.</p>
<p><img alt="Navigation toolbar" src="/Reverse_Engineering/Images/Navigation_toolbar.png" /></p>
</li>
<li>
<p><code>Explore Strings</code>. Go to <code>Search -&gt; For Strings</code> and click Search will give us the strings that Ghidra finds within the program. This window can contain very juicy information to help us during the analysis.</p>
<p><img alt="Strings" src="/Reverse_Engineering/Images/Strings.png" /></p>
</li>
</ol>
<h2 id="identifying-c-code-constructs-in-assembly">Identifying C code constructs in Assembly<a class="headerlink" href="#identifying-c-code-constructs-in-assembly" title="Permanent link">&para;</a></h2>
<p>Analyzing the assembly code of the compiled binary can be overwhelming for beginners.
Understanding the assembly instructions and how various programming components are translated/reflected into the assembly is important.
Here, we will examine various C constructs and their corresponding assembly code. This will help us identify and focus on the key parts of the malware during analysis.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Different compilers add their own code for various checks while compiling.</p>
<p>Therefore expect some garbage assembly code that does not make sense.</p>
</div>
<p>There are different approaches to begin analyzing the disassembled code:</p>
<ul>
<li>Locate the <code>main</code> function from the <code>Symbol Tree</code> section.</li>
<li>Check the <code>.text</code> code from the <code>Program Trees</code> section to see the code section and find the entry point.</li>
<li>Search for interesting <code>strings</code> and locate the code from where those strings are referenced.</li>
</ul>
<h3 id="hello-world-example">Hello World example<a class="headerlink" href="#hello-world-example" title="Permanent link">&para;</a></h3>
<p>C code:
<div class="language-C highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1">1</a></span>
<span class="normal"><a href="#__codelineno-0-2">2</a></span>
<span class="normal"><a href="#__codelineno-0-3">3</a></span>
<span class="normal"><a href="#__codelineno-0-4">4</a></span>
<span class="normal"><a href="#__codelineno-0-5">5</a></span>
<span class="normal"><a href="#__codelineno-0-6">6</a></span>
<span class="normal"><a href="#__codelineno-0-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2"></a>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="p">{</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Hello, world!&quot;</span><span class="p">);</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div></p>
<p>Assembly code:
<div class="language-asm highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="nf">section</span><span class="w"> </span><span class="no">.data</span><span class="w"> </span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="w">    </span><span class="no">message</span><span class="w"> </span><span class="no">db</span><span class="w"> </span><span class="err">&#39;</span><span class="no">HELLO</span><span class="w"> </span><span class="no">WORLD</span><span class="p">!!</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="nf">section</span><span class="w"> </span><span class="no">.text</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="w">    </span><span class="nf">global</span><span class="w"> </span><span class="no">_start</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="nl">_start:</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="w">    </span><span class="c1">; write the message to stdout</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="no">eax</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="w">      </span><span class="c1">; write system call</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="no">ebx</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w">      </span><span class="c1">; file descriptor for stdout</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="no">ecx</span><span class="p">,</span><span class="w"> </span><span class="no">message</span><span class="w">    </span><span class="c1">; pointer to message</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="no">edx</span><span class="p">,</span><span class="w"> </span><span class="mi">13</span><span class="w">     </span><span class="c1">; message length</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="w">    </span><span class="nf">int</span><span class="w"> </span><span class="mi">0x80</span><span class="w">        </span><span class="c1">; call kernel</span>
</span></code></pre></div></p>
<p>This program defines a string "HELLO WORLD!!" in the .data section and then uses the <code>write system call</code> to <code>print the string to stdout</code>.</p>
<p><img alt="Hello World example" src="/Reverse_Engineering/Images/Hello_world.png" /></p>
<p>If we look at the disassembled code in the Listings View, we can see instructions to push HELLO WORLD!! to the stack before calling the print function.</p>
<h3 id="for-loop-example">For loop example<a class="headerlink" href="#for-loop-example" title="Permanent link">&para;</a></h3>
<div class="language-C highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1">1</a></span>
<span class="normal"><a href="#__codelineno-2-2">2</a></span>
<span class="normal"><a href="#__codelineno-2-3">3</a></span>
<span class="normal"><a href="#__codelineno-2-4">4</a></span>
<span class="normal"><a href="#__codelineno-2-5">5</a></span>
<span class="normal"><a href="#__codelineno-2-6">6</a></span>
<span class="normal"><a href="#__codelineno-2-7">7</a></span>
<span class="normal"><a href="#__codelineno-2-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="p">{</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-asm highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-3-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-3-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-3-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-3-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-3-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-3-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-3-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-3-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-3-10">10</a></span>
<span class="normal"><a href="#__codelineno-3-11">11</a></span>
<span class="normal"><a href="#__codelineno-3-12">12</a></span>
<span class="normal"><a href="#__codelineno-3-13">13</a></span>
<span class="normal"><a href="#__codelineno-3-14">14</a></span>
<span class="normal"><a href="#__codelineno-3-15">15</a></span>
<span class="normal"><a href="#__codelineno-3-16">16</a></span>
<span class="normal"><a href="#__codelineno-3-17">17</a></span>
<span class="normal"><a href="#__codelineno-3-18">18</a></span>
<span class="normal"><a href="#__codelineno-3-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="nl">main:</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="w">    </span><span class="c1">; initialize loop counter to 1</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="no">ecx</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4"></a>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5"></a><span class="w">    </span><span class="c1">; loop 5 times</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6"></a><span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="no">edx</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7"></a><span class="nl">loop:</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8"></a><span class="w">    </span><span class="c1">; print the loop counter</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9"></a><span class="w">    </span><span class="nf">push</span><span class="w"> </span><span class="no">ecx</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10"></a><span class="w">    </span><span class="nf">push</span><span class="w"> </span><span class="no">format</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11"></a><span class="w">    </span><span class="nf">call</span><span class="w"> </span><span class="no">printf</span>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12"></a><span class="w">    </span><span class="nf">add</span><span class="w"> </span><span class="no">esp</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13"></a>
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14"></a><span class="w">    </span><span class="c1">; increment loop counter</span>
</span><span id="__span-3-15"><a id="__codelineno-3-15" name="__codelineno-3-15"></a><span class="w">    </span><span class="nf">inc</span><span class="w"> </span><span class="no">ecx</span>
</span><span id="__span-3-16"><a id="__codelineno-3-16" name="__codelineno-3-16"></a>
</span><span id="__span-3-17"><a id="__codelineno-3-17" name="__codelineno-3-17"></a><span class="w">    </span><span class="c1">; check if the loop is finished</span>
</span><span id="__span-3-18"><a id="__codelineno-3-18" name="__codelineno-3-18"></a><span class="w">    </span><span class="nf">cmp</span><span class="w"> </span><span class="no">ecx</span><span class="p">,</span><span class="w"> </span><span class="no">edx</span>
</span><span id="__span-3-19"><a id="__codelineno-3-19" name="__codelineno-3-19"></a><span class="w">    </span><span class="nf">jle</span><span class="w"> </span><span class="no">loop</span>
</span></code></pre></div></td></tr></table></div>
<h3 id="function-example">Function example<a class="headerlink" href="#function-example" title="Permanent link">&para;</a></h3>
<div class="language-C highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1">1</a></span>
<span class="normal"><a href="#__codelineno-4-2">2</a></span>
<span class="normal"><a href="#__codelineno-4-3">3</a></span>
<span class="normal"><a href="#__codelineno-4-4">4</a></span>
<span class="normal"><a href="#__codelineno-4-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="kt">int</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="p">)</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="p">{</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-asm highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1">1</a></span>
<span class="normal"><a href="#__codelineno-5-2">2</a></span>
<span class="normal"><a href="#__codelineno-5-3">3</a></span>
<span class="normal"><a href="#__codelineno-5-4">4</a></span>
<span class="normal"><a href="#__codelineno-5-5">5</a></span>
<span class="normal"><a href="#__codelineno-5-6">6</a></span>
<span class="normal"><a href="#__codelineno-5-7">7</a></span>
<span class="normal"><a href="#__codelineno-5-8">8</a></span>
<span class="normal"><a href="#__codelineno-5-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="nl">add:</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="w">    </span><span class="nf">push</span><span class="w"> </span><span class="no">ebp</span><span class="w">          </span><span class="c1">; save the current base pointer value</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="no">ebp</span><span class="p">,</span><span class="w"> </span><span class="no">esp</span><span class="w">      </span><span class="c1">; set base pointer to current stack pointer value</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="no">eax</span><span class="p">,</span><span class="w"> </span><span class="no">dword</span><span class="w"> </span><span class="no">ptr</span><span class="w"> </span><span class="p">[</span><span class="no">ebp</span><span class="err">+</span><span class="mi">8</span><span class="p">]</span><span class="w">  </span><span class="c1">; move the value of &#39;a&#39; into the eax register</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="w">    </span><span class="nf">add</span><span class="w"> </span><span class="no">eax</span><span class="p">,</span><span class="w"> </span><span class="no">dword</span><span class="w"> </span><span class="no">ptr</span><span class="w"> </span><span class="p">[</span><span class="no">ebp</span><span class="err">+</span><span class="mi">12</span><span class="p">]</span><span class="w"> </span><span class="c1">; add the value of &#39;b&#39; to the eax register</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6"></a><span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="no">dword</span><span class="w"> </span><span class="no">ptr</span><span class="w"> </span><span class="p">[</span><span class="no">ebp-4</span><span class="p">],</span><span class="w"> </span><span class="no">eax</span><span class="w">  </span><span class="c1">; move the sum into the &#39;result&#39; variable</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7"></a><span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="no">eax</span><span class="p">,</span><span class="w"> </span><span class="no">dword</span><span class="w"> </span><span class="no">ptr</span><span class="w"> </span><span class="p">[</span><span class="no">ebp-4</span><span class="p">]</span><span class="w">  </span><span class="c1">; move the value of &#39;result&#39; into the eax register</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8"></a><span class="w">    </span><span class="nf">pop</span><span class="w"> </span><span class="no">ebp</span><span class="w">           </span><span class="c1">; restore the previous base pointer value</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9"></a><span class="w">    </span><span class="nf">ret</span><span class="w">               </span><span class="c1">; return to calling function</span>
</span></code></pre></div></td></tr></table></div>
<p>The add function starts by saving the current base pointer value onto the stack.
Then, it sets the base pointer to the current stack pointer value.
The function then moves the values of a and b into the eax register, adds them, and store the result in the result variable.
Finally, the function moves the value of the result into the eax register, restores the previous base pointer value, and returns to the calling function.</p>
<h2 id="an-overview-of-api-calls">An overview of API calls<a class="headerlink" href="#an-overview-of-api-calls" title="Permanent link">&para;</a></h2>
<p>The Windows API is a <code>collection of functions and services</code> the Windows Operating System provides to <code>enable developers to create Windows applications</code>.
These functions include <code>creating windows</code>, <code>menus</code>, <code>buttons</code>, and <code>other user-interface elements</code> and <code>performing tasks</code> such as file input/output and network communication.</p>
<h3 id="createprocessa-example">CreateProcessA example<a class="headerlink" href="#createprocessa-example" title="Permanent link">&para;</a></h3>
<p>The <code>CreateProcessA</code> function creates a new process and its primary thread. The function takes several parameters, including the name of the executable file, command-line arguments, and security attributes.</p>
<p><img alt="Windows API syntax" src="/Reverse_Engineering/Images/Win_syntax.png" /></p>
<p>Here is an example of C code that uses the CreateProcessA function to launch a new process:</p>
<div class="language-C highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-6-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-6-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-6-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-6-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-6-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-6-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-6-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-6-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-6-10">10</a></span>
<span class="normal"><a href="#__codelineno-6-11">11</a></span>
<span class="normal"><a href="#__codelineno-6-12">12</a></span>
<span class="normal"><a href="#__codelineno-6-13">13</a></span>
<span class="normal"><a href="#__codelineno-6-14">14</a></span>
<span class="normal"><a href="#__codelineno-6-15">15</a></span>
<span class="normal"><a href="#__codelineno-6-16">16</a></span>
<span class="normal"><a href="#__codelineno-6-17">17</a></span>
<span class="normal"><a href="#__codelineno-6-18">18</a></span>
<span class="normal"><a href="#__codelineno-6-19">19</a></span>
<span class="normal"><a href="#__codelineno-6-20">20</a></span>
<span class="normal"><a href="#__codelineno-6-21">21</a></span>
<span class="normal"><a href="#__codelineno-6-22">22</a></span>
<span class="normal"><a href="#__codelineno-6-23">23</a></span>
<span class="normal"><a href="#__codelineno-6-24">24</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;windows.h&gt;</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2"></a>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4"></a><span class="p">{</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5"></a><span class="w">    </span><span class="n">STARTUPINFO</span><span class="w"> </span><span class="n">si</span><span class="p">;</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6"></a><span class="w">    </span><span class="n">PROCESS_INFORMATION</span><span class="w"> </span><span class="n">pi</span><span class="p">;</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7"></a>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8"></a><span class="w">    </span><span class="n">ZeroMemory</span><span class="p">(</span><span class="o">&amp;</span><span class="n">si</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">si</span><span class="p">));</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9"></a><span class="w">    </span><span class="n">si</span><span class="p">.</span><span class="n">cb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">si</span><span class="p">);</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10"></a><span class="w">    </span><span class="n">ZeroMemory</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pi</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">pi</span><span class="p">));</span>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11"></a>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">CreateProcess</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;C:</span><span class="se">\\\\</span><span class="s">Windows</span><span class="se">\\\\</span><span class="s">notepad.exe&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">FALSE</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">si</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">pi</span><span class="p">))</span>
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14"></a><span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;CreateProcess failed (%d).</span><span class="se">\\</span><span class="s">n&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">GetLastError</span><span class="p">());</span>
</span><span id="__span-6-15"><a id="__codelineno-6-15" name="__codelineno-6-15"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</span><span id="__span-6-16"><a id="__codelineno-6-16" name="__codelineno-6-16"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-6-17"><a id="__codelineno-6-17" name="__codelineno-6-17"></a>
</span><span id="__span-6-18"><a id="__codelineno-6-18" name="__codelineno-6-18"></a><span class="w">    </span><span class="n">WaitForSingleObject</span><span class="p">(</span><span class="n">pi</span><span class="p">.</span><span class="n">hProcess</span><span class="p">,</span><span class="w"> </span><span class="n">INFINITE</span><span class="p">);</span>
</span><span id="__span-6-19"><a id="__codelineno-6-19" name="__codelineno-6-19"></a>
</span><span id="__span-6-20"><a id="__codelineno-6-20" name="__codelineno-6-20"></a><span class="w">    </span><span class="n">CloseHandle</span><span class="p">(</span><span class="n">pi</span><span class="p">.</span><span class="n">hProcess</span><span class="p">);</span>
</span><span id="__span-6-21"><a id="__codelineno-6-21" name="__codelineno-6-21"></a><span class="w">    </span><span class="n">CloseHandle</span><span class="p">(</span><span class="n">pi</span><span class="p">.</span><span class="n">hThread</span><span class="p">);</span>
</span><span id="__span-6-22"><a id="__codelineno-6-22" name="__codelineno-6-22"></a>
</span><span id="__span-6-23"><a id="__codelineno-6-23" name="__codelineno-6-23"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-6-24"><a id="__codelineno-6-24" name="__codelineno-6-24"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
<p>When compiled into assembly code, the CreateProcessA function call looks like this:
<div class="language-asm highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-7-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-7-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-7-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-7-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-7-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-7-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-7-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-7-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-7-10">10</a></span>
<span class="normal"><a href="#__codelineno-7-11">11</a></span>
<span class="normal"><a href="#__codelineno-7-12">12</a></span>
<span class="normal"><a href="#__codelineno-7-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="nf">push</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="nf">lea</span><span class="w"> </span><span class="no">eax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">esp</span><span class="err">+</span><span class="mi">10</span><span class="no">h</span><span class="err">+</span><span class="no">StartupInfo</span><span class="p">]</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="nf">push</span><span class="w"> </span><span class="no">eax</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4"></a><span class="nf">lea</span><span class="w"> </span><span class="no">eax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">esp</span><span class="err">+</span><span class="mi">14</span><span class="no">h</span><span class="err">+</span><span class="no">ProcessInformation</span><span class="p">]</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5"></a><span class="nf">push</span><span class="w"> </span><span class="no">eax</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6"></a><span class="nf">push</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7"></a><span class="nf">push</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8"></a><span class="nf">push</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9"></a><span class="nf">push</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10"></a><span class="nf">push</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11"></a><span class="nf">push</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12"></a><span class="nf">push</span><span class="w"> </span><span class="no">dword</span><span class="w"> </span><span class="no">ptr</span><span class="w"> </span><span class="p">[</span><span class="no">hWnd</span><span class="p">]</span>
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13"></a><span class="nf">call</span><span class="w"> </span><span class="no">CreateProcessA</span>
</span></code></pre></div></td></tr></table></div></p>
<p>This assembly code <code>pushes the necessary parameters onto the stack in reverse order</code> and then calls the CreateProcessA function. The CreateProcessA function then launches a new process and returns a handle to the process and its primary thread.</p>
<p>During malware analysis, identifying the API call and examining the code can help understand the malware's purpose.</p>
<h2 id="common-apis-used-by-malware">Common APIs used by Malware<a class="headerlink" href="#common-apis-used-by-malware" title="Permanent link">&para;</a></h2>
<p>Malware authors heavily rely on Windows APIs to accomplish their goals. It's important to know the Windows APIs used in different malware variants. It's an important step in advanced static analysis to examine the <code>import</code> functions, which can reveal much about the malware.</p>
<h3 id="keylogger">Keylogger<a class="headerlink" href="#keylogger" title="Permanent link">&para;</a></h3>
<ul>
<li><code>SetWindowsHookEx</code>: Installs an <code>application-defined hook procedure into a hook chain</code>. Used to <code>monitor and intercept system events</code>, such as <code>keystrokes</code> or <code>mouse clicks</code>.</li>
<li><code>GetAsyncKeyState</code>: Retrieves the status of a virtual key when the function is called. Used to <code>determine if a key is being pressed</code> or <code>released</code>.</li>
<li><code>GetKeyboardState</code>: Retrieves the status of all virtual keys. Used to <code>determine the status of all key</code>s on the keyboard.</li>
<li><code>GetKeyNameText</code>: Retrieves the <code>name of a key</code>. Used to <code>determine the name of the pressed key</code>.</li>
</ul>
<h3 id="downloader">Downloader<a class="headerlink" href="#downloader" title="Permanent link">&para;</a></h3>
<p>Designed to download other malware onto a victim's system.</p>
<ul>
<li><code>URLDownloadToFile</code>: <code>Downloads a file</code> from the internet and saves it to a local file. Used to <code>download additional malicious code</code> or updates to the malware.</li>
<li><code>WinHttpOpen</code>: <code>Initializes the WinHTTP API</code>. Used to <code>establish an HTTP connection to a remote server</code> and download additional malicious code.</li>
<li><code>WinHttpConnect</code>: <code>Establishes a connection</code> to a remote server using the WinHTTP API. Used to <code>connect to a remote server and download additional malicious code</code>.</li>
<li><code>WinHttpOpenRequest</code>: <code>Opens HTTP request</code> using the WinHTTP API. Used to <code>send HTTP requests to a remote server</code> and download additional malicious code or steal data.</li>
</ul>
<h3 id="c2-communication">C2 Communication<a class="headerlink" href="#c2-communication" title="Permanent link">&para;</a></h3>
<p>Command and Control (C2) communication is a method malware uses to communicate with a remote server or attacker.</p>
<ul>
<li><code>InternetOpen</code>: <code>Initializes a session for connecting to the internet</code>. Used to <code>connect to a remote server and communicate with a command-and-control (C2) server</code>.</li>
<li><code>InternetOpenUrl</code>:<code>Opens a URL</code> for download. Used to <code>download additional malicious code</code> or steal data from a C2 server.</li>
<li><code>HttpOpenRequest</code>: <code>Opens HTTP request</code>. Used to <code>send HTTP requests to a C2 server and receive commands</code> or additional malicious code.</li>
<li><code>HttpSendRequest</code>: Sends <code>HTTP request to a C2 server</code>. Used to <code>send data or receive commands</code> from a C2 server.</li>
</ul>
<h3 id="data-exfiltration">Data Exfiltration<a class="headerlink" href="#data-exfiltration" title="Permanent link">&para;</a></h3>
<p>Unauthorized data transfer from an organization to an external destination.</p>
<ul>
<li><code>InternetReadFile</code>: <code>Reads data from a handle to an open internet resource</code>. Used to <code>steal data from a compromised system and transmit it to a C2 server</code>.</li>
<li><code>FtpPutFile</code>: <code>Uploads a file to an FTP server</code>. Used to <code>exfiltrate stolen data to a remote server</code>.</li>
<li><code>CreateFile</code>: <code>Creates or opens a file or device</code>. Used to <code>read or modify files containing sensitive information</code> or <code>system configuration data</code>.</li>
<li><code>WriteFile</code>: <code>Writes data to a file or device</code>. Used to <code>write stolen data to a file and then exfiltrate it</code> to a remote server.</li>
<li><code>GetClipboardData</code>: Used to <code>retrieve data from the clipboard</code>. Used to <code>retrieve sensitive data that is copied to the clipboard</code>.</li>
</ul>
<h3 id="dropper">Dropper<a class="headerlink" href="#dropper" title="Permanent link">&para;</a></h3>
<p>Designed to install other malware onto a victim's system.</p>
<ul>
<li><code>CreateProcess</code>: <code>Creates a new process and its primary thread</code>. Used to <code>execute its code in the context of a legitimate process</code>, making it more difficult to detect and analyze.</li>
<li><code>VirtualAlloc</code>: Reserves or commits a region of memory within the virtual address space of the calling process. Malware can use this function to <code>allocate memory to store its code</code>.</li>
<li><code>WriteProcessMemory</code>: Writes data to an area of memory within the address space of a specified process. Used to <code>write its code to the allocated memory</code>.</li>
</ul>
<h3 id="api-hooking">API Hooking<a class="headerlink" href="#api-hooking" title="Permanent link">&para;</a></h3>
<p><code>Intercept calls to Windows APIs and modify their behavior</code>.</p>
<ul>
<li><code>GetProcAddress</code>: <code>Retrieves the address of an exported function or variable</code> from a specified dynamic-link library (DLL). Used to <code>locate and hook API calls made by other processes</code>.</li>
<li><code>LoadLibrary</code>: Loads a dynamic-link library (DLL) into a process's address space. Used to <code>load and execute additional code from a DLL or other module</code>.</li>
<li><code>SetWindowsHookEx</code> This API is used to <code>install a hook procedure that monitors messages sent to a window or system event</code>. Used to <code>intercept calls to other Windows APIs and modify their behavior</code>.</li>
</ul>
<h3 id="anti-debugging-and-vm-detection">Anti-debugging and VM detection<a class="headerlink" href="#anti-debugging-and-vm-detection" title="Permanent link">&para;</a></h3>
<p>Evade detection and analysis by security researchers.</p>
<ul>
<li><code>IsDebuggerPresent</code>: Checks whether a process is running under a debugger. Used to <code>determine whether it is being analyzed</code> and take appropriate action to evade detection.</li>
<li><code>CheckRemoteDebuggerPresent</code>: Checks whether a remote debugger is debugging a process. Used to <code>determine whether it is being analyzed</code> and take appropriate action to evade detection.</li>
<li><code>NtQueryInformationProcess</code>: Retrieves information about a specified process. Used to <code>determine whether the process is being debugged</code> and take appropriate action to evade detection.</li>
<li><code>GetTickCount</code>: Retrieves the number of milliseconds that have elapsed since the system was started. Used to <code>determine whether it is running in a virtualized environment</code>, which may indicate that it is being analyzed.</li>
<li><code>GetModuleHandle</code>: Retrieves a handle to a specified module. Used to <code>determine whether it is running under a virtualized environment</code>, which may indicate that it is being analyzed.</li>
<li><code>GetSystemMetrics</code>: Retrieves various system metrics and configuration settings. Used to <code>determine whether it is running under a virtualized environment</code>, which may indicate that it is being analyzed.</li>
</ul>
<p>Read more on <a href="https://malapi.io/">malapi.io</a> to learn about APIs used in different malware families.</p>
<h2 id="analyzing-process-hollowing">Analyzing process hollowing<a class="headerlink" href="#analyzing-process-hollowing" title="Permanent link">&para;</a></h2>
<p>Let's take analyze a code sample that uses <a href="https://attack.mitre.org/techniques/T1055/012/">process hollowing</a>.</p>
<p>An important point to note is that almost all malware comes <code>packed with known or custom packers</code> and also have employed different Anti-debugging / VM detection techniques to hinder the analysis. </p>
<p>This sample is not packed and has no Anti-debugging / VM detection techniques is applied.</p>
<p>Our objective of advanced static analysis would be to:
- <code>Examine the API calls</code> to find a pattern or suspicious call.
- Look at the suspicious <code>strings</code>.
- Find <code>interesting or malicious functions</code>.
- Examine the disassembled/decompiled code to <code>find as much information as possible</code>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>It's important to mention that starting to search for the CreateProcessA function right away is not how an analyst would start analyzing an unknown binary. This whole example is just to get comfertable with Ghidra.</p>
</div>
<h3 id="createprocess">CreateProcess<a class="headerlink" href="#createprocess" title="Permanent link">&para;</a></h3>
<p>The suspicious process creates a victim process in the suspended state.</p>
<p>To confirm, let's search for the CreateProcessA API in the Symbol Tree section.</p>
<p>Then, <code>right-click on the Show References</code> to option to display all the program sections where this function is called.</p>
<p>Clicking on the first reference will take us to the disassembled code and show the decompiled C code in the Decompile section.</p>
<p>It clearly shows how the parameters on the stack are being pushed in reverse order before calling the function. The value <code>0x4</code> in the <code>process creation flag</code> is being pushed into the stack, representing the <code>suspended state</code>.</p>
<h3 id="graph-view">Graph View<a class="headerlink" href="#graph-view" title="Permanent link">&para;</a></h3>
<p>Clicking on the Display Function Graph in the toolbar will show the graph view of the disassembled code we are examining.</p>
<p><img alt="Function graph" src="/Reverse_Engineering/Images/Function_graph.png" /></p>
<p>In the above case, if the program:</p>
<ul>
<li>Fails to create a victim process in the suspended state, it will move to block 1. The <code>red arrow represents the failure</code> to meet the condition mentioned above.</li>
<li>Successfully creates the victim process, it will move to block 2. The <code>green arrow represents the success</code> of the jump condition.</li>
</ul>
<h3 id="example-of-further-analysis">Example of further analysis<a class="headerlink" href="#example-of-further-analysis" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>Opening a suspicous file</p>
<p>The CreateFileA API is used to either create or open an existing file.</p>
</li>
<li>
<p>Hollowing the process</p>
<p>Malware use ZwUnmapViewOfSection or NtUnmapViewOfSection API calls to unmap the target process's memory.</p>
<p>NtUnmapViewOfSection takes exactly two arguments, the base address (virtual address) to be unmapped and the handle to the process that needs to be hollowed.</p>
</li>
<li>
<p>Allocating memory</p>
<p>Once the process is hollowed, malware must allocate the memory using VirtualAllocEx before writing the process.</p>
<p>Arguments passed to the function include a handle to the process, address to be allocated, size, allocation type, and memory protection flag.</p>
</li>
<li>
<p>Writing down the memory</p>
<p>Once the memory is allocated, the malware will attempt to write the suspicious process/code into the memory of the hollowed process. The WriteProcessMemory API is used for this purpose.</p>
<p>There were three calls to the WriteProcessMemory Function. The last call references to the code in the Kernel32 DLL; therefore, we can ignore that. From the decompiled code, it seems the program is copying different sections of the suspicious process one by one.</p>
</li>
<li>
<p>Resuming the thread</p>
<p>Once all is sorted out, the malware will get hold of the thread using the SetThreadContext and then resume the thread using the ResumeThread API to execute the code.</p>
</li>
</ol>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../Basic_static/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Basic">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Basic
              </div>
            </div>
          </a>
        
        
          
          <a href="../Basic_dynamic/" class="md-footer__link md-footer__link--next" aria-label="Next: Basic">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Basic
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      <a href="https://github.com/grimy86/grimy86.github.io/blob/main/LICENSE">Copyright &copy; since 2024</a>

    </div>
  
  
</div>
      
        <div class="md-social">
  
    
    
    
    
    <a href="mailto:grimy86@proton.me" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M48 64C21.5 64 0 85.5 0 112c0 15.1 7.1 29.3 19.2 38.4l217.6 163.2c11.4 8.5 27 8.5 38.4 0l217.6-163.2c12.1-9.1 19.2-23.3 19.2-38.4 0-26.5-21.5-48-48-48zM0 176v208c0 35.3 28.7 64 64 64h384c35.3 0 64-28.7 64-64V176L294.4 339.2a63.9 63.9 0 0 1-76.8 0z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://github.com/grimy86" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.instant.prefetch", "navigation.instant.progress", "navigation.tracking", "navigation.tabs", "navigation.sections", "navigation.path", "navigation.prune", "navigation.indexes", "navigation.top", "navigation.footer"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>